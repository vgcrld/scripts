#!/usr/bin/env ruby
#
require 'rubygems'
require 'bundler/setup'
require 'galileo_db'
require 'galileo_api'
require 'galileo_api_client'
require 'rest-client'
require 'galileo_testing'

api = Galileo::API.new('development')
login = api.user_login( username: "galileo", password: "galileo", customer: "TEST" )

ap rept = api.analytics_pie_report( "storage_by_volume_low_iops_sum_90d_perf", [{:name=>"storage_by_volume_low_iops_sum_90d_perf", :type=>["disk", "xivdisk", "dsdisk", "netapp_7m_volume", "netapp_cdot_volume", "flashvdisk", "infinidatvolume", "infinidatfs", "vmaxvolume", "vnxlun", "emcunitylun", "purevolume", "xtremiovolume", "ds8kvolume"], :master_type=>["disk", "xivvolume", "dsvolume", "netapp_7m_volume", "netapp_cdot_volume", "flashvdisk", "infinidatvolume", "infinidatfs", "vmaxvolume", "vnxlun", "emcunitylun", "purevolume", "xtremiovolume", "ds8kvolume"], :agg_type=>["disk", "xivvolume", "dsvolume", "netapp_7m_volume", "netapp_cdot_volume", "flashvdisk", "infinidatvolume", "infinidatfs", "vmaxvolume", "vnxlun", "emcunitylun", "purevolume", "xtremiovolume", "ds8kvolume"], :selector=>{:class=>"tag", :value=>["VDISK@CLUSTER", "VOLUME@XIV", "LOGICAL@LAYER", "VOLUME@NETAPP_7M", "VOLUME@NETAPP_CDOT", "VDISK@FLASH", "VOLUME@INFINIDAT", "FS@INFINIDAT", "VOLUME@VMAX", "LUN@VNX", "LUN@EMCUNITY", "VOLUME@PURE", "VOLUME@XTREMIO", "VOL@DS8K"]}, :use_masters=>true, :slice_by=>{:trends=>[{:name=>"ds8k_transfers", :type=>"ds8kvolume", :agg_func=>"MAX", :hours_back=>1720, :sql_formula=>"(DS8K_volume_total_transfers_sec)"}, {:name=>"xtremio_volume", :type=>"xtremiovolume", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(1e0*CAST(volume_trend_post_iops AS DEC(18,6)))"}, {:name=>"emcunity_volume", :type=>"emcunitylun", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(COALESCE(lun_reads,0) + COALESCE(lun_writes, 0))"}, {:name=>"netapp_disk", :type=>"netapp_7m_volume", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(1e0*(CAST(CifsReadOps AS DEC(15,5)) + CAST(FcpReadOps AS DEC(15,5)) + CAST(IscsiReadOps AS DEC(15,5)) + CAST(NfsReadOps AS DEC(15,5)) + CAST(CifsWriteOps AS DEC(15,5)) + CAST(FcpWriteOps AS DEC(15,5)) + CAST(IscsiWriteOps AS DEC(15,5)) + CAST(NfsWriteOps AS DEC(15,5))))"}, {:name=>"svc_disk", :type=>"disk", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(DiskReadXfer + DiskWriteXfer)"}, {:name=>"ds_disk", :type=>"dsdisk", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(DiskXfer)"}, {:name=>"vnx_lun", :type=>"vnxlun", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(VnxlunReadIOs+VnxlunWriteIOs)"}, {:name=>"xiv_disk", :type=>"xivdisk", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(1e0*(CAST(CAST(XIVReadHitSmallIops + XIVReadHitMediumIops + XIVReadHitLargeIops + XIVReadHitVeryLargeIops AS DEC(15,5)) + CAST(XIVReadMissSmallIops + XIVReadMissMediumIops + XIVReadMissLargeIops + XIVReadMissVeryLargeIops AS DEC(15,5)) AS DEC(15,5)) + CAST(CAST(XIVWriteHitSmallIops + XIVWriteHitMediumIops + XIVWriteHitLargeIops + XIVWriteHitVeryLargeIops AS DEC(15,5)) + CAST(XIVWriteMissSmallIops + XIVWriteMissMediumIops + XIVWriteMissLargeIops + XIVWriteMissVeryLargeIops AS DEC(15,5)) AS DEC(15,5))))"}, {:name=>"pure_disk", :type=>"purevolume", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(COALESCE(PUREVOLUME_reads_per_sec,0) + COALESCE(PUREVOLUME_writes_per_sec, 0))"}, {:name=>"netapp_cdot_volume", :type=>"netapp_cdot_volume", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(CAST(ReadTransfers AS DEC(18,5)) + CAST(WriteTransfers AS DEC(18,5)))"}, {:name=>"vmax_volume", :type=>"vmaxvolume", :agg_func=>"SUM", :hours_back=>2160, :sql_formula=>"(1e0 * (ReadOps + WriteOps))"}], :matchers=>[{:for=>"all", :numeric_partition=>{:order=>[0, 10, 50], :labels=>["0", "1-10", "11-50", "_exclude"]}}]}, :aggregate=>"sum", :aggregate_sub=>"count", :aggregate_type=>"B", :aggregate_configs=>[{:name=>"ds8k_capcity", :config_names=>["CfgDS8KClusterFBVolumeCapBinGB"], :transform_var=>"var", :transform_code=>"var.to_f*1024**3"}, {:name=>"svc_capcity", :config_names=>["CfgSVCDiskCapacity", "CfgDSLogicalCapacity"], :transform_var=>"var", :transform_code=>"var.to_f"}, {:name=>"xiv_capcity", :config_names=>["CfgXIVVolumeSizeMiB"], :transform_var=>"var", :transform_code=>"var.to_f*1024**2"}], :aggregate_trends=>[{:name=>"xtremio_volume_cap", :type=>"xtremiovolume", :agg_func=>"AVG", :hours_back=>24, :sql_formula=>"(1e0*CAST(volume_trend_post_size AS DEC(18,6))*1024)"}, {:name=>"pure_capacity", :type=>"purevolume", :agg_func=>"AVG", :hours_back=>24, :sql_formula=>"((PUREVOLUME_space_size_gb) * 1024 * 1024 * 1024)"}, {:name=>"emcunity_capacity", :type=>"emcunitylun", :agg_func=>"AVG", :hours_back=>24, :sql_formula=>"(1e0*CAST(lun_sizetotal AS DEC(18,6))*1024*1024)"}, {:name=>"vnx_capacity", :type=>"vnxlun", :agg_func=>"AVG", :hours_back=>24, :sql_formula=>"(1e0*CAST(VnxlunSize AS DEC(18,6))*1024*1024*1024)"}, {:name=>"netapp_capacity", :type=>"netapp_7m_volume", :agg_func=>"AVG", :hours_back=>24, :sql_formula=>"(1e0*CAST(SizeTotal AS DEC(18,6))*1024*1024*1024)"}, {:name=>"netapp_cdot_capacity", :type=>"netapp_cdot_volume", :agg_func=>"AVG", :hours_back=>24, :sql_formula=>"((1e0*CAST(SizeTotal AS DEC(18,5))) * 1024 * 1024 * 1024)"}, {:name=>"vmax_vol_capacity", :type=>"vmaxvolume", :agg_func=>"AVG", :hours_back=>24, :sql_formula=>"(1e0*CAST(TotalSpaceGB AS DEC(18,6))*1024*1024*1024)"}]}], {:range_type=>"last_1440", :timezone=>"EST5EDT"}, {} )
